<head>
	<style>
		body {
			font-family: monospace;
		}
	</style>
</head>
<body>
	<div id="root"></div>
	<script src="https://unpkg.com/react@16.12.0/umd/react.development.js"></script>
	<script src="https://unpkg.com/react-dom@16.12.0/umd/react-dom.development.js"></script>
	<script src="https://unpkg.com/@babel/standalone@7.8.3/babel.js"></script>
	<script type="text/babel">
		function sortByKey(array, key) {
			return array.sort((a, b) =>
				a[key] > b[key] ? 1 : b[key] > a[key] ? -1 : 0
			);
		}

		function PokemonInfo({ pokemonName }) {
			const [pokemon, setPokemon] = React.useState(null);

			React.useEffect(() => {
				if (!pokemonName) {
					return;
				}

				getFromAPI({ query: 'getPokemon', name: pokemonName }).then(
					(pokemonData) => {
						setPokemon(pokemonData.pokemon);
					}
				);
			}, [pokemonName]);

			console.log(pokemon);

			if (!pokemonName) {
				return 'Submit a pokemon';
			}

			if (!pokemon) {
				return (
					<>
						<p>
							Are you sure
							<strong> {pokemonName} </strong>
							is how you spell it?
						</p>
					</>
				);
			}

			return (
				<>
					<img src={pokemon.image} alt={pokemon.name} />
					<h1>{pokemon.name}</h1>
					<pre>{JSON.stringify(pokemon, null, 2)}</pre>
				</>
			);
		}

		function App() {
			const [pokemonName, setPokemonName] = React.useState('');
			const [allPokemons, setAllPokemons] = React.useState([]);

			function getAllPokemons() {
				getFromAPI({ query: 'getAllPokemons' }).then((data) => {
					const sortedPokemons = sortByKey([...data.pokemons], 'name');
					console.log('[data]', data);
					console.log('[sortedPokemons]', sortedPokemons);
					setAllPokemons(sortedPokemons);
				});
			}

			function handleSubmit(event) {
				event.preventDefault();
				setPokemonName(event.target.elements.pokemonName.value);
			}

			React.useEffect(() => {
				getAllPokemons();
			}, []);

			// return (
			// 	<div>
			// 		<form onSubmit={handleSubmit}>
			// 			<label htmlFor="pokemonName">Pokemon Name: </label>
			// 			<div>
			// 				<input id="pokemonName" style={{ marginRight: '10px' }} />
			// 				<button type="submit">Submit</button>
			// 			</div>
			// 		</form>
			// 		<hr />
			// 		<PokemonInfo pokemonName={pokemonName} />
			// 	</div>
			// );

			return (
				<div>
					<form onSubmit={handleSubmit}>
						<label htmlFor="pokemonName">Pokemon Name: </label>
						<div>
							<select id="pokemonName" style={{ marginRight: '10px' }}>
								{allPokemons.map((pokemon) => {
									const { id, name } = pokemon;
									return (
										<option key={id} value={name}>
											{name}
										</option>
									);
								})}
							</select>
							<button type="submit">Submit</button>
						</div>
					</form>
					<hr />
					<PokemonInfo pokemonName={pokemonName} />
				</div>
			);
		}

		function getFromAPI({ query, name }) {
			const queries = {
				getPokemon: `
		      query ($name: String) {
		        pokemon(name: $name) {
		          id
		          number
						name
						image
		          attacks {
		            special {
		              name
		              type
		              damage
							}
		          }
		        }
					}`,
				getAllPokemons: `query {
		        pokemons(first: 999) {
							id
							name
						}
					}`
			};

			return window
				.fetch('https://graphql-pokemon2.vercel.app/', {
					// learn more about this API here: https://github.com/lucasbento/graphql-pokemon
					method: 'POST',
					headers: {
						'content-type': 'application/json;charset=UTF-8'
					},
					body: JSON.stringify({
						query: queries[query],
						variables: { name }
					})
				})
				.then((r) => r.json())
				.then((response) => response.data);
		}

		ReactDOM.render(<App />, document.getElementById('root'));
	</script>
</body>
